<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>extsrv</title>
</head>
<body>
    <div>
    <div class="header">
        <h1>Virtual private server setup</h1>
        
        <ol>
            <li><a href="#article" class="skip-link">Main article</a></li>
            <li><a href="#item2" class="skip-link"></a></li>
            <li><a href="#setup" class="skip-link">Setup</a></li>
            <li><a href="#item4" class="skip-link"></a></li>
            <li><a href="#links" class="skip-link">Links</a></li>
            <li><a href="index.html">Main page</a></li>
        </ol>
    </div>
    <div class="main-content">
        <main id="article"></main>
        <h2><a href="https://habr.com/ru/articles/799751/" target="_blank">Main article</a></h2>
        
        <main id="item2"></main>
        <h2><a href="" target="_blank"></a></h2>
        Допустим, я скачиваю фотографию ветки сакуры с сайта в Японии в формате PNG. Изображение ведь не умещается в одном фрейме и его стек TCP/IP поделит на фреймы. <br>

        На всех этапах перемещения данных по стеку TCP/IP каждый протокол добавляет свой заголовок и передает информацию на следующий уровень абстракции: данные с уровня приложений получают заголовок TСP, потом — заголовок IP, потом — еще заголовок Ethernet. Затем считается контрольная сумма всего созданного из этих заголовков и данных фрейма (FCS). Причем на каждом уровне абстракции мы используем еще и разные названия для структур данных: фрейм (кадр), датаграмма, пакет, сегмент. На уровне приложений, согласно модели OSI ISO, используется термин транзакция. Транзакцией могут быть DNS-запрос и ответ, HTTP-запрос и ответ, SQL-запрос и ответ, запрос и ответный видеопоток YouTube или IP-телефонии. В количестве транзакций в секунду измеряют производительность NGFW, ведь его уровень сборки и анализа информации — именно уровень приложений. <br>

        В итоге все эти заголовки и данные объединяются в единый фрейм для передачи, и его длина в сумме составляет 1518 байт. Ваши файлы, записи голоса и видео в виде нарезанных кусочков c размером MSS перемещаются в поле Payload. <br>

        Система DPI выполняет глубокий анализ всех проходящих через неё пакетов. Помимо изучения пакетов по неким стандартным паттернам, по которым можно однозначно определить принадлежность пакета определённому приложению, скажем, по формату заголовков, номерам портов и т.п., система DPI осуществляет и так называемый поведенческий анализ трафика, который позволяет распознать приложения, не использующие для обмена данными заранее известные заголовки и структуры данных. <br>

        Система DPI, как правило, устанавливается на границе сети оператора в разрыв существующих аплинков, уходящих от пограничных маршрутизаторов. Тем самым, весь трафик, который покидает или входит в сеть оператора, проходит через DPI, что даёт возможность его мониторинга и контроля. Основная проблема всех существующих решений DPI заключается в том, что для того, чтобы однозначно определить принадлежность того или иного потока данных к одному из сетевых приложений, устройство, осуществляющее анализ трафика, должно увидеть оба направления сессии. Иными словами, входящий и исходящий трафик в пределах одного flow должны пройти через одно и то же устройство. Если оборудование понимает, что видит только одно направление в рамках сессии, оно не имеет возможности соотнести данный flow с какой-либо известной категорией трафика со всеми вытекающими последствиями. <br>

        Shadowsocks-2022 - удобный и простой в настройке клиент/сервер, основанный на Shadowsocks. На сегодняшний день вполне работает, можно пользоваться. Одно но: так как трафик SS представляет из себя совершенно рандомный набор байт без каких‑либо узнаваемых сигнатур, блокировку по белым спискам протоколов он не переживет. <br>

        <a href="https://habr.com/ru/companies/amnezia/articles/769992/">AmneziaWG</a> — улучшение протокола Wireguard, разработанное командой проекта Amnezia VPN, чтобы сделать Wireguard устойчивым к детектированию оборудованием DPI, при этом сохранив его преимущества. Он действительно работает, и работает неплохо. Минус тот же, как и SS — поскольку оборудование ТСПУ этот протокол не распознаёт, то блокировку по белым спискам протоколам в случае чего он не переживет. <br>

        VLESS — самый распространенный и перспективный на сегодняшний день протокол, от создателей известного клиента‑сервера XRay. Работает поверх TLS, искуссно маскируясь под обращение к какому‑нибудь безобидному веб‑сайту. С расширением XTLS‑Reality сервер очень достоверно маскируется под какой‑нибудь известный и популярный сайт (например, google.com, vk.com, и т. д.), и представляется его аутентичным TLS‑сертификатом. В момент установления подключения, клиент «подмешивает» в поля хендшейка определенные данные, определить наличие которых можно только зная секретный ключ, при этом со стороны хендшейк выглядит обычно. Прокси‑сервер, зная секретный ключ, может определить, был ли запрос на установку соединения послан от прокси‑клиента или же от кого‑то другого (например, цензора, желающего проверить, что там на сервере). В первом случае установится подключение для передачи данных через прокси, во втором случае прокси начнет прозрачно пересылать запросы на сервер сайта, под который мы маскируемся, в результате чего цензор увидит самый настоящий сертификат этого сайта, и вообще поведение нашего сервера будет полностью соответствовать поведению сервера этого сайта. VLESS всегда используется с TLS в качестве транспорта - в итоге при правильной настройке подключения через VLESS всегда как минимум один раз шифруются. <br>
        
        <main id="setup"></main>
        <h2>Setup</h2>
        Выбор хостера, подготовка сервера. <br>
        
        В России хостеры должны вноситься в определенный реестр, что влечет для них обязательства слива. Некоторые разделили свой бизнес на разные части: российскую (домен в зоне «.ru» и российское юрлицо) и выставление счетов в рублях, и не‑российскую (домен в другой зоне, например «.com», и юрлицо где‑нибудь в Британии, Эмиратах или на Кипре) с выставлением счетов в евро/долларах, но при этом даже во втором случае часто можно по‑прежнему платить российскими рублевыми банковскими картами. Поэтому при возможности стоит предпочесть этот вариант например, VDSina, Aeza, Inferno Solutions.
        Также не самым плохим вариантом может быть не‑российские хостеры, но при это дружелюбные к российским клиентам, например PQ.hosting, Friendhosting, LLHOST, is*hosting. Если есть возможность оплачивать услуги иностранными картами, то можно выбирать все что угодно. <br>
        
        Выбирать можно дешёвое устройство с одним ядром и 512 мегабайт памяти. Тип виртуализации — не важен КVM или OpenVZ.

        1. Сменить пароль пользователя root с изначального на ваш уникальный (passwd root)
        2. Не использовать учетную запись root, а создать непривелигированного пользователя командой adduser <username> и назначить ей сложный пароль
        3. Когда вы убедитесь, что она работает, стоит запретить вход для root‑юзера по SSH, выставив (раскомментировав) в «no» или «prohibit‑password» опцию PermitRootLogin в файле /etc/ssh/sshd_config
        Поменять пользователя $ whoami user1 $ su - user2
        4. Перевесить SSH со стандартного порта 22 на нестандартный порт (например, на 54 321, 41 467, выберите любой рандомный выше 1000). Это особенно важно для маскировки XTLS‑Reality. Порт задается опцией «Port» в том же /etc/ssh/sshd_config
        5. Обновите версии пакетов в системе на свежие, в Debian и Ubuntu это делается командами apt update и apt upgrade

        Процесс установки XRay
        Скачиваем самую свежую версию XRay-core: wget https://github.com/XTLS/Xray-core/releases/download/v24.12.31/Xray-linux-64.zip
        Создаем каталог, распаковываем и делаем исполняемым файл (поскольку он поставляется в архиве .zip, права доступа могут быть потеряны при распаковке):
        mkdir /opt/xray
        sudo apt-get install zip unzip
        unzip ./Xray-linux-64.zip -d /opt/xray
        chmod +x /opt/xray/xray

        Затем создаем systemd-юнит (nano /usr/lib/systemd/system/xray.service) и вставляем в него следующий текст

        [Unit]
         Description=XRay
         [Service]
         Type=simple
         Restart=on-failure
         RestartSec=30
         WorkingDirectory=/opt/xray
         ExecStart=/opt/xray/xray run -c /opt/xray/config.json
         [Install]
         WantedBy=multi-user.target
        
        Активируем:
        systemctl daemon-reload
        systemctl enable xray

        Настройка VLESS c XTLS-Reality
        Сначала нужно определиться, под какой сайт вы будете маскироваться.
        поищите какие-нибудь не слишком популярные сайты (к ним меньше внимания) в сети того же хостинга, что и ваш сервер. Для этого существует утилита, скачать готовый экзешник можно там со страницы Releases.
        https://github.com/XTLS/RealiTLScanner/releases/download/v0.2.1/RealiTLScanner-linux-64

        Запускаете ее командой ./RealiTLScanner -addr IP_вашего_VPS -showFail
        и внимательно изучаете результаты. Если в какой‑то из строк написано «Found TLS», то сначала попробуйте зайти на этот адрес (по доменному имени) браузером, должен открыться какой‑то сайт без ошибок, далее проверьте с помощью какого‑нибудь сервиса или утилитой ping, что IP‑адрес за этим доменом совпадает с тем, что вы нашли (иначе это может быть какой‑нибудь ваш единомышленник, поднявший XTLS‑Reality у себя), и в заключение проверьте командой curl как выше, что сервер соответствует всем требованиям. curl -v -L --tlsv1.3 --http2 https://www.microsoft.com. Если в ответ вы видите много логов и HTML-код, то все хорошо, должно работать.

        Важно! От используемого домена маскировки зависит скорость установления подключения клиентом с вашим сервером (а их будет устанавливаться много). Если после настройки все работает, но сильно тормозит при серфинге, попробуйте использовать другой маскировочный домен (в идеале это должен быть какой-то сервер в той же стране, где и ваш VPS).
        
        <main id="item4"></main>
        <h2><a href="" target="_blank"></a></h2>
        
        <main id="links"></main>
        <h2>Links</h2>
        <a href="https://lowendbox.com/category/virtual-servers,dedicated-servers,reseller-hosting,shared-hosting,special-offers,seedbox-offers,community-offers,vpn/" target="_blank">LowEndBox</a> - разные акционные предложения от хостеров со всего мира<br>
        <a href="https://www.netcup.com/en/server/vps" target="_blank">Netcup VPS</a><br>
        <a href="https://www.cloudflare.com/learning/cdn/what-is-a-cdn/" target="_blank">CDN</a><br>
        <a href="" target="_blank"></a><br>
        <a href="" target="_blank"></a><br>
        <a href="" target="_blank"></a><br>
        <a href="" target="_blank"></a><br>
    </div>
    <div class="footer">
        <h2><a href="index.html">Return to the main page</a></h2>
    </div>
    </div>
</body>
</html>